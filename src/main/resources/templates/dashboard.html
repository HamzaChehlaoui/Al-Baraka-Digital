<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Al Baraka Digital</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="glass card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <h2 style="margin: 0; color: var(--primary);">Al Baraka Digital</h2>
                <span class="badge" style="background: rgba(255,255,255,0.1);" 
                      sec:authentication="principal.authorities">Role</span>
            </div>
            <div style="display: flex; align-items: center; gap: 1rem;">
                <span sec:authentication="name" style="color: var(--text-muted);">User</span>
                <form th:action="@{/logout}" method="post">
                    <button type="submit" class="btn btn-danger" style="padding: 0.5rem 1rem;">Logout</button>
                </form>
            </div>
        </header>

        <div class="dashboard-grid">
            <!-- Sidebar -->
            <aside class="glass card sidebar">
                <nav>
                    <a href="#" class="nav-link active">Dashboard</a>
                    <a href="#" class="nav-link">Profile</a>
                    <a href="#" class="nav-link">Settings</a>
                </nav>
            </aside>

            <!-- Main Content -->
            <main>
                <!-- Client View -->
                <div sec:authorize="hasRole('CLIENT')">
                    <h2 style="margin-bottom: 1.5rem;">Welcome back!</h2>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="glass card stat-card">
                            <h3 style="color: var(--text-muted); font-size: 0.875rem;">Total Balance</h3>
                            <p style="font-size: 2rem; margin: 0.5rem 0;">25,430 DH</p>
                        </div>
                        <div class="glass card stat-card">
                            <h3 style="color: var(--text-muted); font-size: 0.875rem;">Pending Operations</h3>
                            <p style="font-size: 2rem; margin: 0.5rem 0;">1</p>
                        </div>
                    </div>
                    
                    <div class="glass card" style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem;">New Operation</h3>
                        <form th:action="@{/client/operations/create}" method="post" enctype="multipart/form-data" style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label>Type</label>
                                    <select name="type" class="form-control" style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;">
                                        <option value="DEPOSIT">Deposit</option>
                                        <option value="WITHDRAWAL">Withdrawal</option>
                                        <option value="TRANSFER">Transfer</option>
                                    </select>
                                </div>
                                <div>
                                    <label>Amount (DH)</label>
                                    <input type="number" name="amount" step="0.01" min="0.01" class="form-control" style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;" required>
                                </div>
                            </div>
                            <div>
                                <label>Description</label>
                                <input type="text" name="description" class="form-control" style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;">
                            </div>
                            <div>
                                <label>Justification Document (> 10,000 DH)</label>
                                <input type="file" name="file" class="form-control" style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;">
                            </div>
                            <button type="submit" class="btn btn-primary" style="justify-self: start;">Submit Operation</button>
                        </form>
                    </div>

                    <div class="glass card">
                        <h3>Recent Operations</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="op : ${operations}">
                                    <td th:text="${op.id}">1</td>
                                    <td th:text="${op.type}">DEPOSIT</td>
                                    <td th:text="${op.amount} + ' DH'">1000 DH</td>
                                    <td>
                                        <span th:text="${op.status}" 
                                              th:class="${'badge ' + (op.status.name() == 'APPROVED' ? 'badge-approved' : (op.status.name() == 'REJECTED' ? 'badge-rejected' : 'badge-pending'))}">
                                            PENDING
                                        </span>
                                    </td>
                                    <td th:text="${#temporals.format(op.date, 'dd-MM-yyyy HH:mm')}">01-01-2024</td>
                                </tr>
                                <tr th:if="${operations == null || operations.empty}">
                                    <td colspan="5" style="text-align: center; color: var(--text-muted);">No operations found.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Agent View -->
                <div sec:authorize="hasRole('AGENT')">
                    <h2 style="margin-bottom: 1.5rem;">Agent Dashboard</h2>
                    
                    <div class="glass card">
                        <h3 style="margin-bottom: 1rem;">Pending Approvals</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="op : ${pendingOperations}">
                                    <td th:text="${op.id}">1</td>
                                    <td th:text="${op.type}">TRANSFER</td>
                                    <td th:text="${op.amount} + ' DH'">15000 DH</td>
                                    <td><span class="badge badge-pending">PENDING</span></td>
                                    <td>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <form th:action="@{/agent/operations/review}" method="post" style="display: inline;">
                                                <input type="hidden" name="operationId" th:value="${op.id}">
                                                <input type="hidden" name="action" value="APPROVE">
                                                <button type="submit" class="btn btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; background-color: #28a745; border-color: #28a745;">Approve</button>
                                            </form>
                                            <form th:action="@{/agent/operations/review}" method="post" style="display: inline;">
                                                <input type="hidden" name="operationId" th:value="${op.id}">
                                                <input type="hidden" name="action" value="REJECT">
                                                <button type="submit" class="btn btn-danger" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Reject</button>
                                            </form>
                                            <a th:href="@{'/api/agent/operations/' + ${op.id} + '/documents'}" target="_blank" class="btn" style="padding: 0.25rem 0.5rem; font-size: 0.8rem; background-color: #6c757d; color: white;">Docs</a>
                                        </div>
                                    </td>
                                </tr>
                                <tr th:if="${pendingOperations == null || pendingOperations.empty}">
                                    <td colspan="5" style="text-align: center; color: var(--text-muted);">No pending operations.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Admin View -->
                <div sec:authorize="hasRole('ADMIN')">
                    <h2 style="margin-bottom: 1.5rem;">Admin Dashboard</h2>
                    <div class="glass card">
                        <h3>User Management</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="user : ${users}">
                                    <td th:text="${user.id}">1</td>
                                    <td th:text="${user.name}">John Doe</td>
                                    <td th:text="${user.email}">john@example.com</td>
                                    <td th:text="${user.role}">CLIENT</td>
                                    <td><span class="badge badge-approved" th:text="${user.active ? 'Active' : 'Inactive'}">Active</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>
</body>
</html>
